# üì± Frontend Next.js Mobile - Application Pr√©parations V√©hicules

## üéØ Vue d'Ensemble

Application mobile-first d√©velopp√©e en Next.js pour les pr√©parateurs de v√©hicules SIXT. Interface optimis√©e pour smartphones (Android/iOS) permettant la gestion compl√®te des pointages et pr√©parations de v√©hicules avec workflow photo.

## üèóÔ∏è Architecture Technique

### Stack Technologique

- **Framework** : Next.js 14 (App Router)
- **TypeScript** : Pour la robustesse du code
- **Styling** : Tailwind CSS + Shadcn/UI
- **State Management** : Zustand
- **HTTP Client** : Axios avec intercepteurs JWT
- **PWA** : Support offline et installation
- **Camera** : API native + compression client
- **Notifications** : Push notifications web

### Structure du Projet

```
vehicle-prep-mobile/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îú‚îÄ‚îÄ (dashboard)/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ preparations/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ timesheets/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îú‚îÄ‚îÄ globals.css
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/ (shadcn)
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îú‚îÄ‚îÄ preparations/
‚îÇ   ‚îú‚îÄ‚îÄ timesheets/
‚îÇ   ‚îî‚îÄ‚îÄ shared/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ api.ts
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts
‚îÇ   ‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îú‚îÄ‚îÄ useCamera.ts
‚îÇ   ‚îî‚îÄ‚îÄ usePreparation.ts
‚îî‚îÄ‚îÄ public/
    ‚îú‚îÄ‚îÄ icons/
    ‚îú‚îÄ‚îÄ manifest.json
    ‚îî‚îÄ‚îÄ sw.js
```

## üì± Pages & Fonctionnalit√©s

### üîê Authentification (`/login`)

- **Connexion** : Email/mot de passe
- **Validation** : Formulaire s√©curis√©
- **Auto-login** : Token persistant
- **Redirection** : Vers dashboard apr√®s connexion

### üè† Dashboard (`/dashboard`)

- **Statut du jour** : Pointage actuel, temps travaill√©
- **Pr√©paration en cours** : Carte avec progression temps r√©el
- **Actions rapides** : Boutons pointer/d√©marrer pr√©paration
- **Statistiques semaine** : R√©sum√© performances
- **Notifications** : Alertes et informations importantes

### ‚è∞ Pointage (`/timesheets`)

- **Statut actuel** : Arriv√©/parti, pause en cours
- **Actions de pointage** : 4 boutons (arriv√©e/d√©part/pause d√©but/fin)
- **S√©lection agence** : Dropdown des agences assign√©es
- **Planning du jour** : Horaires pr√©vus vs r√©els
- **Historique** : Liste pointages avec filtres date/agence

### üöó Pr√©parations (`/preparations`)

#### Page Principale

- **Nouvelle pr√©paration** : Bouton CTA principal
- **Pr√©paration active** : Interface workflow si en cours
- **Historique** : Liste pr√©parations avec recherche par plaque
- **Statistiques** : Performances personnelles

#### D√©marrage Pr√©paration (`/preparations/new`)

- **S√©lection agence** : Dropdown avec agence par d√©faut du planning
- **Saisie v√©hicule** :
  - Plaque d'immatriculation (validation format)
  - Marque (liste pr√©d√©finie + saisie libre)
  - Mod√®le (saisie libre)
  - Couleur (optionnel)
  - Ann√©e (optionnel)
  - √âtat g√©n√©ral (dropdown)
- **Notes** : Commentaires optionnels
- **Validation** : V√©rification donn√©es + d√©marrage

#### Workflow Pr√©paration (`/preparations/[id]`)

- **Header fixe** : V√©hicule, chrono 30min, progression
- **6 √âtapes obligatoires** :
  1. üöó Pr√©paration ext√©rieure
  2. ü™ë Pr√©paration int√©rieure
  3. ‚õΩ Mise √† niveau essence
  4. üõû Pression pneus + lave-glace
  5. üßΩ Lavage sp√©cial
  6. üÖøÔ∏è Stationnement

- **Interface √©tape** :
  - Photo obligatoire (cam√©ra native)
  - Preview et validation photo
  - Notes optionnelles
  - Validation √©tape

- **Incidents** : Bouton signaler probl√®me avec photo
- **Finalisation** : R√©sum√© complet + validation finale

### üë§ Profil (`/profile`)

- **Informations** : Nom, email, agences assign√©es
- **Statistiques** : Graphiques performances d√©taill√©es
- **Planning semaine** : Vue calendaire des cr√©neaux
- **Badges** : Syst√®me gamification (ponctualit√©, rapidit√©, etc.)
- **Param√®tres** : Th√®me, notifications, d√©connexion

## üé® Design System

### Principes Mobile-First

- **√âcrans** : Optimis√© 375px-428px (iPhone/Android)
- **Touch targets** : Minimum 44px pour navigation tactile
- **Navigation** : Bottom tabs pour usage une main
- **Dark mode** : Support th√®me sombre automatique
- **Accessibilit√©** : Contraste WCAG AA, labels ARIA

### Palette de Couleurs

```css
:root {
  --primary: #2563eb; /* Bleu SIXT */
  --secondary: #10b981; /* Vert validation */
  --warning: #f59e0b; /* Orange alertes */
  --error: #ef4444; /* Rouge erreurs */
  --background: #ffffff;
  --surface: #f8fafc;
  --text-primary: #1e293b;
}

[data-theme="dark"] {
  --background: #0f172a;
  --surface: #1e293b;
  --text-primary: #f1f5f9;
}
```

### Composants Cl√©s

- **BottomNavigation** : 4 onglets principaux
- **ActionButton** : Boutons d'action larges et visibles
- **PhotoCapture** : Interface cam√©ra optimis√©e mobile
- **ProgressBar** : Indicateur visuel workflow
- **StepCard** : Carte √©tape avec photo et validation
- **Toast** : Notifications non-intrusives

## üîÑ Gestion d'√âtat (Zustand)

### AuthStore

```typescript
interface AuthStore {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
  refreshToken: () => Promise<void>;
}
```

### TimesheetStore

```typescript
interface TimesheetStore {
  todayStatus: TimesheetStatus | null;
  clockIn: (agencyId: string) => Promise<void>;
  clockOut: (agencyId: string, notes?: string) => Promise<void>;
  startBreak: (agencyId: string) => Promise<void>;
  endBreak: (agencyId: string) => Promise<void>;
}
```

### PreparationStore

```typescript
interface PreparationStore {
  currentPreparation: Preparation | null;
  userAgencies: Agency[];
  startPreparation: (data: VehicleData) => Promise<void>;
  completeStep: (stepType: string, photo: File) => Promise<void>;
  completePreparation: () => Promise<void>;
  addIssue: (type: string, description: string, photo?: File) => Promise<void>;
}
```

## üì± Fonctionnalit√©s Natives

### PWA (Progressive Web App)

- **Installation** : Ajout √©cran d'accueil Android/iOS
- **Offline** : Cache donn√©es essentielles + interface
- **Notifications** : Push web pour alertes importantes
- **Icons** : Ic√¥nes adaptatives toutes r√©solutions

### Cam√©ra & Photos

- **Capture native** : getUserMedia avec fallback
- **Compression** : R√©duction automatique qualit√©/taille
- **Formats** : JPEG optimis√© pour upload Cloudinary
- **Preview** : Aper√ßu avant validation
- **Retry** : Reprendre photo si n√©cessaire

### Performance

- **Code splitting** : Chargement par route
- **Image optimization** : Next.js Image component
- **Bundle size** : <500KB initial, <1MB total
- **Lazy loading** : Composants et donn√©es
- **Service Worker** : Cache intelligent

## üîå Int√©gration Backend

### API Endpoints Utilis√©es

```typescript
// Authentification
POST /api/auth/login
GET /api/auth/me
POST /api/auth/logout

// Pointages
GET /api/timesheets/today-status
POST /api/timesheets/clock-in
POST /api/timesheets/clock-out
POST /api/timesheets/break-start
POST /api/timesheets/break-end
GET /api/timesheets/history

// Pr√©parations
GET /api/preparations/user-agencies
POST /api/preparations/start
GET /api/preparations/current
PUT /api/preparations/:id/step
POST /api/preparations/:id/complete
POST /api/preparations/:id/issue
GET /api/preparations/history
GET /api/preparations/my-stats

// Profil
GET /api/profile/dashboard
GET /api/profile/schedule/week
GET /api/profile/performance
```

### Types TypeScript

```typescript
interface User {
  id: string;
  email: string;
  firstName: string;
  lastName: string;
  role: "preparateur";
  agencies: Agency[];
  stats: UserStats;
}

interface Agency {
  id: string;
  name: string;
  code: string;
  client: string;
  isDefault?: boolean;
}

interface Preparation {
  id: string;
  vehicle: Vehicle;
  agency: Agency;
  startTime: Date;
  endTime?: Date;
  status: "in_progress" | "completed" | "cancelled";
  steps: PreparationStep[];
  progress: number;
  currentDuration: number;
  isOnTime?: boolean;
}

interface PreparationStep {
  type: string;
  label: string;
  completed: boolean;
  photoUrl?: string;
  completedAt?: Date;
  notes?: string;
}
```

## üß™ Tests & Qualit√©

### Strat√©gie de Tests

- **Unit Tests** : Jest + React Testing Library
- **E2E Tests** : Playwright workflows critiques
- **Visual Testing** : Storybook + Chromatic
- **Device Testing** : iOS Safari + Android Chrome

### Performance Monitoring

- **Core Web Vitals** : LCP, FID, CLS
- **Bundle Analysis** : webpack-bundle-analyzer
- **Lighthouse CI** : Score >90 mobile
- **Sentry** : Error tracking et performance

## üöÄ Installation & D√©veloppement

### Pr√©requis

```bash
Node.js >= 18
npm ou yarn
```

### Installation

```bash
# Cloner le projet frontend
git clone [url] vehicle-prep-mobile
cd vehicle-prep-mobile

# Installer les d√©pendances
npm install

# Configurer l'environnement
cp .env.example .env.local
# √âditer .env.local avec l'URL backend
```

### Variables d'Environnement

```bash
# Backend API
NEXT_PUBLIC_API_URL=http://localhost:4000
NEXT_PUBLIC_APP_NAME="Vehicle Prep"

# PWA
NEXT_PUBLIC_VAPID_PUBLIC_KEY=your_vapid_key

# Sentry (optionnel)
NEXT_PUBLIC_SENTRY_DSN=your_sentry_dsn
```

### Scripts de D√©veloppement

```bash
# D√©veloppement
npm run dev

# Build production
npm run build

# D√©marrer production
npm start

# Tests
npm test
npm run test:e2e

# Linting
npm run lint
npm run type-check
```

## üìä M√©triques & Analytics

### M√©triques Business

- **Adoption** : Taux installation PWA
- **Engagement** : Sessions/jour, dur√©e moyenne
- **Efficiency** : Temps moyen pointage/pr√©paration
- **Quality** : Taux completion workflow

### Monitoring Technique

- **Performance** : Core Web Vitals, bundle size
- **Erreurs** : Crash rate, API failures
- **Usage** : Features les plus utilis√©es
- **Offline** : Fr√©quence mode hors-ligne

---

## ‚úÖ Compatibilit√© Backend

### üéØ **Fonctionnalit√©s 100% Support√©es**

‚úÖ **Authentification**

- Login/logout ‚Üê `POST /api/auth/login`
- Refresh token ‚Üê `GET /api/auth/me`
- Gestion JWT ‚Üê Middleware `auth` complet

‚úÖ **Pointages**

- Clock in/out ‚Üê `POST /api/timesheets/clock-in|out`
- Gestion pauses ‚Üê `POST /api/timesheets/break-start|end`
- Statut du jour ‚Üê `GET /api/timesheets/today-status`
- Historique ‚Üê `GET /api/timesheets/history`

‚úÖ **Pr√©parations**

- Cr√©ation avec v√©hicule ‚Üê `POST /api/preparations/start` (nouveau sch√©ma)
- Workflow 6 √©tapes ‚Üê `PUT /api/preparations/:id/step`
- Upload photos ‚Üê Middleware `uploadPreparationPhoto`
- Finalisation ‚Üê `POST /api/preparations/:id/complete`
- Incidents ‚Üê `POST /api/preparations/:id/issue`

‚úÖ **Agences & Flexibilit√©**

- Agences utilisateur ‚Üê `GET /api/preparations/user-agencies` (nouvelle route)
- Changement agence facturation ‚Üê Support dans `startWithVehicle`
- Agence par d√©faut du planning ‚Üê Logique dans backend

‚úÖ **Donn√©es Riches**

- Profil complet ‚Üê `GET /api/profile/dashboard`
- Statistiques ‚Üê `GET /api/preparations/my-stats`
- Historique v√©hicule ‚Üê `GET /api/preparations/vehicle-history/:plate`

### üîß **Ce qui n√©cessite les nouvelles routes**

1. **Route agences utilisateur** : `GET /api/preparations/user-agencies`
2. **Validation v√©hicule int√©gr√©** : Sch√©ma `startWithVehicle`
3. **Upload middleware** : D√©j√† pr√©sent et fonctionnel

### üéØ **Conclusion**

**Le backend supporte √† 100% toutes les fonctionnalit√©s pr√©vues pour le frontend !** üöÄ

Les seules additions n√©cessaires sont :

- ‚úÖ Nouvelle route `/api/preparations/user-agencies` (fournie)
- ‚úÖ Nouveau sch√©ma de validation (fourni)
- ‚úÖ Route historique par plaque (fournie)

**Le frontend Next.js peut √™tre d√©velopp√© imm√©diatement avec l'architecture backend actuelle !** üí™

---

## üéØ Prochaines √âtapes

1. **Setup projet Next.js** avec structure recommand√©e
2. **Configuration PWA** et service worker
3. **D√©veloppement MVP** : Auth + Dashboard + Pointage basique
4. **Workflow pr√©parations** avec cam√©ra et upload photos
5. **Tests dispositifs** r√©els iOS/Android
6. **Optimisations performance** et bundle size
7. **D√©ploiement production** avec CI/CD

**Le d√©veloppement peut commencer imm√©diatement !** üöÄ
